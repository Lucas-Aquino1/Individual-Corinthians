<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/style.css" />

</head>

<body onload="listar()">
  <div class="div_nav">
    <a href="index.html"><img src="imgs/logoPreto2.png" alt="Simbolo Corinthians" id="img_logo_nav"></a>
    <ul class="links">
      <li>
        <a href="index.html" class="link_nav">Home</a>
      </li>
      <li>
        <a href="sobreNos.html" class="link_nav">Sobre Mim</a>
      </li>
      <li>
        <a href="elenco.html" class="link_nav">Elenco</a>
      </li>
      <li>
        <a href="curiosidades.html" class="link_nav">Curiosidades</a>
      </li>
      <li>
        <a href="quiz.html" class="link_nav">Quiz</a>
      </li>
      <li>
        <a href="login.html" class="link_nav">Login</a>
      </li>
    </ul>
  </div>


  <div class="containerC">
    <div class="box">
      <div>
        <h1>Cadastro</h1>
      </div>
      <div class="formulario">
        <p>Nome Completo</p>
        <input type="text" placeholder="Seu nome" id="ipt_nome">
        <p>Email</p>
        <input type="email" placeholder="seuemail@provedor.com" id="ipt_email">
        <p>Insira seu Estado</p>
        <select id="ipt_Estado">
          <option value="vazio">Selecione seu estado</option>
            <option value="1">Acre</option>
            <option value="2">Alagoas</option>
            <option value="3">Amapá</option>
            <option value="4">Amazonas</option>
            <option value="5">Bahia</option>
            <option value="6">Ceará</option>
            <option value="7">Espírito Santo</option>
            <option value="8">Goiás</option>
            <option value="9">Distrito Federal</option>
            <option value="10">Maranhão</option>
            <option value="11">Mato Grosso</option>
            <option value="12">Mato Grosso do Sul</option>
            <option value="13">Minas Gerais</option>
            <option value="14">Pará</option>
            <option value="15">Paraíba</option>
            <option value="16">Paraná</option>
            <option value="17">Pernambuco</option>
            <option value="18">Piauí</option>
            <option value="19">Rio de Janeiro</option>
            <option value="20">Rio Grande do Norte</option>
            <option value="21">Rio Grande do sul</option>
            <option value="22">Rondônia</option>
            <option value="23">Roraima</option>
            <option value="24">Santa Catarina</option>
            <option value="25">São Paulo</option>
            <option value="26">Sergipe</option>
            <option value="27">Tocantins</option>
        </select>

        <p>Senha</p>
        <input type="password" placeholder="***********" id="ipt_senha1">
        <p>Confirmar senha</p>
        <input type="password" placeholder="***********" id="ipt_senha2">
        <p>Você é sócio do programa Fiel Torcedor?</p>
        <input type="checkbox" id="ipt_sociotorcedorSim"> Sim
        <p>Qual seu jogador preferido?</p>
        <select name="jogadores" id="ipt_jogadorPreferido">
          <option value="Yuri Alberto">Yuri Alberto</option>
          <option value="Rodrigo Garro">Rodrigo Garro</option>
          <option value="Memphis">Memphis</option>
          <option value="Romero">Romero</option>
          <option value="Hugo Souza">Hugo Souza</option>
          <option value="André Carrillo">André Carrillo</option>
          <option value="Breno Bidon">Breno Bidon</option>
          <option value="Fabrizio Angileri">Fabrizio Angileri</option>
          <option value="Matheuzinho">Matheuzinho</option>
          <option value="Matheus Bidu">Matheus Bidu</option>
          <option value="André Ramalho">André Ramalho</option>
          <option value="Cacá">Cacá</option>
          <option value="Félix Torres">Félix Torres</option>
          <option value="Gustavo Henrique">Gustavo Henrique</option>
          <option value="Alex Santana">Alex Santana</option>
          <option value="José Martínez">José Martínez</option>
          <option value="Ryan">Ryan</option>
          <option value="Maycon">Maycon</option>
          <option value="Raniele">Raniele</option>
          <option value="Igor Coronado">Igor Coronado</option>  
          <option value="Talles Magno">Talles Magno</option>
        </select>
        <p>Você já foi para a Neo Quimica Arena?</p>
        <input type="checkbox" id="ipt_visitouEstadio"> Sim
        <!-- TERMINAR DE FAZER AS VARIAVEIS -->


        <button onclick="cadastrar()">Cadastrar</button>
        <div id="cadastroResposta"></div>
      </div>
    </div>
  </div>



  <div class="footer">
    <div class="redes-sociais">
      <h4>Redes sociais</h4>
      <ul>
        <li><img src="imgs/instagram.png" alt=""></li>
        <li><img src="imgs/youtube.png" alt=""></li>
        <li><img src="imgs/linkedin-Photoroom.png" alt=""></li>
      </ul>
    </div>
    <div class="logo">
      <img src="imgs/logoNav.jpg" alt="">
    </div>
    <div class="contato">
      <h4>Contato</h4>
      <p>lucas.aquino@sptech.school</p>
      <p>+55 (11) 999999999</p>
    </div>
  </div>

</body>

</html>

<script>

  // Array para armazenar empresas cadastradas para validação de código de ativação 
  let listaEmpresasCadastradas = [];

  function cadastrar() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = ipt_nome.value;
    var emailVar = ipt_email.value;
    var senhaVar = ipt_senha1.value;
    var confirmacaoSenhaVar = ipt_senha2.value;
    var EstadoVar = ipt_Estado.value;
    var socioTorcedorVar = ipt_sociotorcedorSim.value
    var jogadorPreferidoVar = ipt_jogadorPreferido.value
    var visitouEstadioVar = ipt_visitouEstadio.value

    if(socioTorcedorVar){
      socioTorcedorVar = "S"
    } else {
      socioTorcedorVar = "N"
    }

    if(visitouEstadioVar){
      visitouEstadioVar = "S"
    } else {
      visitouEstadioVar = "N"
    }

    let emailTemArroba = emailVar.includes('@');
    let senhaTemEspaco = senhaVar.includes(' ');
    let confirmarSenhaTemEspaco = confirmacaoSenhaVar.includes(' ');





    // Verificando se há algum campo em branco
    if (nomeVar == '' || emailVar == '' || cpfVar == '' || senhaVar == '' || confirmacaoSenhaVar == '') {
      cadastroResposta.innerHTML = `Por favor, preencha todos os campos.`
    } else if (emailTemArroba == false) {
      cadastroResposta.innerHTML = `Insira um email válido.`
    } else if (senhaVar != confirmacaoSenhaVar) {
      cadastroResposta.innerHTML = `Certifique-se de que preencheu os campos 'Senha' e 'Confirmar senha' corretamente.`;
    } else if (senhaTemEspaco || confirmarSenhaTemEspaco) {
      cadastroResposta.innerHTML = `A senha não pode conter espaços.`
    } 
    // else {
    //   cadastroResposta.innerHTML = `<b>
    //     Cadastro realizado com sucesso!</b><br><br>
    //     <a href="login.html">Login</a>
         
    //     `
    // }


    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        EstadoServer: EstadoVar,
        socioTorcedorServer: socioTorcedorVar,
        jogadorPreferidoServer: jogadorPreferidoVar,
        visitouEstadioServer: visitouEstadioVar

      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {


          cadastroResposta.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }



</script>